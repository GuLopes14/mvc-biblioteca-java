<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Meus Empréstimos')}"></head>
<body>
<header th:replace="~{layout :: header}"></header>

<main class="container my-5">
    <h2 class="mb-4">Meus Empréstimos</h2>

    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div th:if="${#lists.isEmpty(loans)}" class="alert alert-info">
        Você não possui empréstimos no momento.
    </div>

    <div th:if="${!#lists.isEmpty(loans)}" class="table-responsive">
        <table class="table table-striped align-middle">
            <thead>
                <tr>
                    <th>Livro</th>
                    <th>Autor</th>
                    <th>Data do Empréstimo</th>
                    <th>Devolução Prevista</th>
                    <th>Status</th>
                    <th style="width: 1%">Ações</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="loan : ${loans}">
                    <td th:text="${loan.book.title}">Título</td>
                    <td th:text="${loan.book.author}">Autor</td>
                    <td th:text="${loan.loanDate}">2025-01-01</td>
                    <td>
                        <span th:text="${loan.dueDate}">2025-01-15</span>
                        <span th:if="${loan.overdue}" class="badge bg-danger ms-2">Atrasado</span>
                    </td>
                    <td>
                        <span th:switch="${loan.status}">
                            <span th:case="'ACTIVE'" class="badge bg-primary">Ativo</span>
                            <span th:case="'RETURNED'" class="badge bg-success">Devolvido</span>
                            <span th:case="'LATE'" class="badge bg-danger">Atrasado</span>
                            <span th:case="*" class="badge bg-secondary" th:text="${loan.status}">Status</span>
                        </span>
                    </td>
                    <td>
                        <form th:if="${loan.status.name() == 'ACTIVE'}" th:action="@{'/loans/' + ${loan.id} + '/return'}" method="post" class="d-inline" onsubmit="return confirm('Confirmar devolução deste livro?');">
                            <button type="submit" class="btn btn-sm btn-outline-success">Devolver</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</main>

<footer th:replace="~{layout :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

